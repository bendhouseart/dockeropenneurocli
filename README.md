# Usage

The scripts contained within are intended to work with docker desktop, permisions on files generated by the included container may be ROOT if
this isn't run via `docker desktop`. That said, if you're on linux this repo is not for you.

[![asciicast](https://asciinema.org/a/MD3u7Sfa9rK3Oi8TQkMpWsAv2.svg)](https://asciinema.org/a/MD3u7Sfa9rK3Oi8TQkMpWsAv2)

## Setup

Build the container (not strictly required, can skip to [Running the container](#running-the-container)):

`./docker_build.sh`

## Running the container

Start up the container with the run script:

`./docker_run.sh`

Then copy in your openneuro api key:

```
galassiae@MH02276145MLI dockeropenneurocli % ./docker_run.sh 
Found docker_build.sh, building image.
[+] Building 0.8s (9/9) FINISHED                                                                                                                    
 => [internal] load build definition from Dockerfile                                                                                           0.0s
 => => transferring dockerfile: 37B                                                                                                            0.0s
 => [internal] load .dockerignore                                                                                                              0.0s
 => => transferring context: 2B                                                                                                                0.0s
 => [internal] load metadata for docker.io/library/node:current-buster-slim                                                                    0.7s
 => [1/4] FROM docker.io/library/node:current-buster-slim@sha256:4108042226221e609bebab7217957281498e23e02782b6a9a784652bf77c13f5              0.0s
 => [internal] load build context                                                                                                              0.0s
 => => transferring context: 42B                                                                                                               0.0s
 => CACHED [2/4] RUN npm install -g @openneuro/cli                                                                                             0.0s
 => CACHED [3/4] ADD login_and_download.sh login_and_download.sh                                                                               0.0s
 => CACHED [4/4] RUN mkdir /download                                                                                                           0.0s
 => exporting to image                                                                                                                         0.0s
 => => exporting layers                                                                                                                        0.0s
 => => writing image sha256:abc4c01b8767fbb57da605a9978c8e4f8ec054d0dec688c7b9291b40a388574a                                                   0.0s
 => => naming to docker.io/library/dockeropenneuro                                                                                             0.0s

Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them
Found image.
dockeropenneuro          latest       abc4c01b8767   13 minutes ago      390MB
? Choose an OpenNeuro instance to use. https://openneuro.org/
? Enter your API key for OpenNeuro (get an API key from https://openneuro.org/keygen) [input is hidden] 
```

Then enter in a dataset to download, that dataset will be downloaded to the directory mounted in the docker run command in `docker_run.sh` by default it is set to `$PWD/download/`.

```? Do you want to enable error reporting to help improve openneuro-cli? No
Usage: openneuro download|d [options] <datasetId> <destination>

Download a dataset draft or snapshot. If neither is specified, will prompt with available snapshots.

Options:
  --draft
  -s, --snapshot [snapshotVersion]
  -h, --help                        display help for command
root@e15d97ab0223:/download# openeuro download ds000001 ds000001/
```

You should see the following if all has gone well:

```
root@882027ea1c87:/download# openneuro download ds000001 ds000001
? Choose a snapshot 1.0.0
 [========================================] 100% | ETA: 0s | 286/286 | CHANGES
 [========================================] 100% | ETA: 0s | 1175/1175 | README
 [========================================] 100% | ETA: 0s | 615/615 | dataset_description.json
 [========================================] 100% | ETA: 0s | 216/216 | participants.tsv
 [========================================] 100% | ETA: 0s | 73/73 | task-balloonanalogrisktask_bold.json
 [========================================] 100% | ETA: 0s | 5663237/5663237 | sub-01/anat/sub-01_T1w.nii.gz
 [========================================] 100% | ETA: 0s | 669578/669578 | sub-01/anat/sub-01_inplaneT2.nii.gz
 [========================================] 100% | ETA: 0s | 47241449/47241449 | sub-01/func/sub-01_task-balloonanalogrisktask_run-01_bold.nii.gz
 [========================================] 100% | ETA: 0s | 8610/8610 | sub-01/func/sub-01_task-balloonanalogrisktask_run-01_events.tsv
 [========================================] 100% | ETA: 0s | 47282515/47282515 | sub-01/func/sub-01_task-balloonanalogrisktask_run-02_bold.nii.gz
 [========================================] 100% | ETA: 0s | 8568/8568 | sub-01/func/sub-01_task-balloonanalogrisktask_run-02_events.tsv
 [========================================] 100% | ETA: 0s | 47347339/47347339 | sub-01/func/sub-01_task-balloonanalogrisktask_run-03_bold.nii.gz
 [========================================] 100% | ETA: 0s | 8132/8132 | sub-01/func/sub-01_task-balloonanalogrisktask_run-03_events.tsv
 [========================================] 100% | ETA: 0s | 5736750/5736750 | sub-02/anat/sub-02_T1w.nii.gz
 [========================================] 100% | ETA: 0s | 718835/718835 | sub-02/anat/sub-02_inplaneT2.nii.gz
 [========================================] 100% | ETA: 0s | 50786740/50786740 | sub-02/func/sub-02_task-balloonanalogrisktask_run-01_bold.nii.gz
 [========================================] 100% | ETA: 0s | 9930/9930 | sub-02/func/sub-02_task-balloonanalogrisktask_run-01_events.tsv
 [========================================] 100% | ETA: 0s | 50719855/50719855 | sub-02/func/sub-02_task-balloonanalogrisktask_run-02_bold.nii.gz
 [========================================] 100% | ETA: 0s | 9647/9647 | sub-02/func/sub-02_task-balloonanalogrisktask_run-02_events.tsv
 [========================================] 100% | ETA: 0s | 50733582/50733582 | sub-02/func/sub-02_task-balloonanalogrisktask_run-03_bold.nii.gz
```

Then after exiting the image your dataset will be available in `download/`:

```
galassiae@MH02276145MLI dockeropenneurocli % tree download 
download
└── ds000001
    ├── CHANGES
    ├── README
    ├── dataset_description.json
    ├── participants.tsv
    ├── sub-01
    │   ├── anat
    │   │   ├── sub-01_T1w.nii.gz
    │   │   └── sub-01_inplaneT2.nii.gz
    │   └── func
    │       ├── sub-01_task-balloonanalogrisktask_run-01_bold.nii.gz
    │       ├── sub-01_task-balloonanalogrisktask_run-01_events.tsv
    │       ├── sub-01_task-balloonanalogrisktask_run-02_bold.nii.gz
    │       ├── sub-01_task-balloonanalogrisktask_run-02_events.tsv
    │       ├── sub-01_task-balloonanalogrisktask_run-03_bold.nii.gz
    │       └── sub-01_task-balloonanalogrisktask_run-03_events.tsv
    ├── sub-02
    │   ├── anat
    │   │   ├── sub-02_T1w.nii.gz
    │   │   └── sub-02_inplaneT2.nii.gz
    │   └── func
    │       ├── sub-02_task-balloonanalogrisktask_run-01_bold.nii.gz
    │       ├── sub-02_task-balloonanalogrisktask_run-01_events.tsv
    │       ├── sub-02_task-balloonanalogrisktask_run-02_bold.nii.gz
    │       ├── sub-02_task-balloonanalogrisktask_run-02_events.tsv
    │       ├── sub-02_task-balloonanalogrisktask_run-03_bold.nii.gz
    │       └── sub-02_task-balloonanalogrisktask_run-03_events.tsv
    ├── sub-03
    │   ├── anat
    │   │   ├── sub-03_T1w.nii.gz
    │   │   └── sub-03_inplaneT2.nii.gz
    │   └── func
    │       ├── sub-03_task-balloonanalogrisktask_run-01_bold.nii.gz
    │       ├── sub-03_task-balloonanalogrisktask_run-01_events.tsv
    │       ├── sub-03_task-balloonanalogrisktask_run-02_bold.nii.gz
    │       ├── sub-03_task-balloonanalogrisktask_run-02_events.tsv
    │       ├── sub-03_task-balloonanalogrisktask_run-03_bold.nii.gz
    │       └── sub-03_task-balloonanalogrisktask_run-03_events.tsv
    ├── sub-04
    │   ├── anat
    │   │   ├── sub-04_T1w.nii.gz
    │   │   └── sub-04_inplaneT2.nii.gz
    │   └── func
    │       ├── sub-04_task-balloonanalogrisktask_run-01_bold.nii.gz
    │       ├── sub-04_task-balloonanalogrisktask_run-01_events.tsv
    │       └── sub-04_task-balloonanalogrisktask_run-02_bold.nii.gz
    └── task-balloonanalogrisktask_bold.json

13 directories, 34 files

```
 
